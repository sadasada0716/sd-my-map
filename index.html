<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>地図 + モーダル表示サンプル</title>

  <!-- Leaflet CSS & JS -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

  <!-- PapaParse（CSV → JSON用） -->
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>

  <style>
    body, html { margin:0; padding:0; height:100%; }
    #map { height: 100%; }

    /* モーダル */
    .modal {
      display: none;
      position: fixed;
      z-index: 1000;
      left:0; top:0;
      width:100%; height:100%;
      background-color: rgba(0,0,0,0.6);
    }
    .modal-content {
      background: #fff;
      margin: 10% auto;
      padding: 20px;
      width: 80%;
      max-width: 500px;
      border-radius: 8px;
      text-align: center;
    }
    .close-btn {
      float: right;
      font-size: 28px;
      cursor: pointer;
    }
    #modal-img { max-width:100%; height:auto; margin-top:10px; }
  </style>
</head>
<body>

<div id="map"></div>

<!-- モーダル -->
<div id="modal" class="modal">
  <div class="modal-content">
    <span class="close-btn">&times;</span>
    <h2 id="modal-title"></h2>
    <p id="modal-desc"></p>
    <img id="modal-img" src="" alt="">
  </div>
</div>

<script>
  // --- モーダル操作関数 ---
function showModal(data) {
  const modal = document.getElementById('modal');
  modal.style.display = 'block';

  document.getElementById('modal-title').textContent = data.name;
  
  // HTMLで複数情報を表示
  document.getElementById('modal-desc').innerHTML = `
    <p>${data.name}</p>
    <p><strong>住所:</strong> ${data.address}</p>
    <p>${data.desc}</p>
  `;

  const img = document.getElementById('modal-img');
  img.src = data.image_url || '';
  img.style.display = data.image_url ? 'block' : 'none';
}

  // --- Leaflet 地図初期化 ---
  const map = L.map('map').setView([35.681, 139.767], 6); // 東京中心
  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    attribution: '© OpenStreetMap contributors'
  }).addTo(map);

  // --- Googleスプレッドシート CSV URL ---
  const SHEET_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vS-NSLyWom17kid2wIQhPnm0Gm1PVn4V7URAqqJyr_DAwotpb5LqoG3dgukSErErFqcYY3cE3X-FYDH/pub?gid=1615166941&single=true&output=csv";

  Papa.parse(SHEET_URL, {
    download: true,
    header: true,
    complete: function(results) {
      // カスタムアイコン
      const customIcon = L.icon({
        iconUrl: 'img/pin2.png', // リポジトリ内画像パス
        iconSize: [40,40],
        iconAnchor: [20,40],
        popupAnchor: [0,-40]
      });

      results.data.forEach(row => {
        const lat = parseFloat(row.lat);
        const lng = parseFloat(row.lng);
        if(!isNaN(lat) && !isNaN(lng)) {
          const marker = L.marker([lat,lng], {icon:customIcon}).addTo(map);

          // クリックでモーダル表示
          marker.on('click', () => {
            showModal(row.name, row.desc, row.image_url);
          });
        }
      });
    }
  });
</script>
</body>
</html>
