<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="utf-8">
  <title>東京消防署マップ</title>
  <link rel="stylesheet" href="style.css">

  <!-- Leaflet -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

  <!-- PapaParse -->
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
</head>
<body>
  <h1>東京消防署マップ</h1>
  <div id="map"></div>

  <script>
    const sheetUrl = "https://docs.google.com/spreadsheets/d/【スプレッドシートID】/pub?output=csv";

    const map = L.map('map').setView([35.68, 139.76], 11);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: '&copy; OpenStreetMap contributors'
    }).addTo(map);

    Papa.parse(sheetUrl, {
      download: true,
      header: true,
      complete: function(results) {
        results.data.forEach(row => {
          if (!row.lat || !row.lng) return;

          // 写真URLが空でなければ <img> を組み込む
          const photoHtml = row.photo
            ? `<br><img src="${row.photo}" alt="${row.name}" style="width:200px;max-height:150px;object-fit:cover;">`
            : "";

          const popupHtml = `
            <b>${row.name}</b><br>
            ${row.address}
            ${photoHtml}
          `;

          L.marker([parseFloat(row.lat), parseFloat(row.lng)])
            .addTo(map)
            .bindPopup(popupHtml);
        });
      }
    });
  </script>
</body>
</html>
