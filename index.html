<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8">
<title>æ±äº¬æ¶ˆé˜²ç½²ãƒãƒƒãƒ—</title>
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
<link rel="stylesheet" href="style.css"/>  
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
<style>
  body { margin:0; padding:0; }
  #map { height:90vh; width:100%; }
</style>
</head>
<body>
<h1 style="text-align:center;margin:10px;">æ±äº¬æ¶ˆé˜²åºmapsspy</h1>
<div id="map"></div>

<script>
const sheetUrl = "https://docs.google.com/spreadsheets/d/e/2PACX-1vTnksYoKQz5NyBwIQUrWeHC9UUgaWFnErJzuBQT36Lrp59gR4Q9fzvGI51EtcoxFJNcJNKE58tv_A_Q/pub?gid=0&single=true&output=csv";

const map = L.map('map').setView([35.68,139.76],11);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);

const redIcon  = L.icon({ iconUrl:'icons/red.png',  iconSize:[32,32], iconAnchor:[16,32], popupAnchor:[0,-32] });
const blueIcon = L.icon({ iconUrl:'icons/blue.png', iconSize:[32,32], iconAnchor:[16,32], popupAnchor:[0,-32] });
const greenIcon= L.icon({ iconUrl:'icons/green.png',iconSize:[32,32], iconAnchor:[16,32], popupAnchor:[0,-32] });  
const orangeIcon= L.icon({ iconUrl:'icons/orange.png',iconSize:[32,32], iconAnchor:[16,32], popupAnchor:[0,-32] });  
const hqrIcon= L.icon({ iconUrl:'icons/hqr.png',iconSize:[32,32], iconAnchor:[16,32], popupAnchor:[0,-32] });  
const hprIcon= L.icon({ iconUrl:'icons/hpr.png',iconSize:[32,32], iconAnchor:[16,32], popupAnchor:[0,-32] });  
  
// â–¼ CSVèª­ã¿è¾¼ã¿
Papa.parse(sheetUrl, {
  download: true,
  header: true,
  complete: function(results) {

    // â˜… ã“ã®ä¸­ã§æ¡ä»¶åˆ†å²ã‚’è¡Œã„ã€ãƒãƒ¼ã‚«ãƒ¼ã‚’è¿½åŠ 
    results.data.forEach(row => {
      if (!row.lat || !row.lng) return;

      // ä¾‹: ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã«ã€Œiconã€åˆ—ã‚’ä½œæˆï¼ˆå€¤ã¯ red / blue / green ãªã©ï¼‰
      let iconChoice = redIcon; // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ
      if (row.icon === "blue")  iconChoice = blueIcon;
      if (row.icon === "green") iconChoice = greenIcon;
      if (row.icon === "orange") iconChoice = orangeIcon;
      if (row.icon === "hqr") iconChoice = hqrIcon;
      if (row.icon === "hpr") iconChoice = hprIcon;

// ğŸ”¹ è»Šä¸¡ãƒŠãƒ³ãƒãƒ¼åˆ—ã‚’ã¾ã¨ã‚ã‚‹ï¼†è‰²åˆ†ã‘
const vehicles = [];
['vehicle1','vehicle2','vehicle3','vehicle4','vehicle5','vehicle6','vehicle7','vehicle8','vehicle9','vehicle10','vehicle11','vehicle12','vehicle13','vehicle14','vehicle15','vehicle16','vehicle17','vehicle18'].forEach(col => {
  const raw = row[col];
  if (!raw || raw.trim() === '') return; // ç©ºæ¬„ã¯ã‚¹ã‚­ãƒƒãƒ—
  const num = raw.trim();

  // --- ã‚¿ã‚¤ãƒ—åˆ¤å®š ---
  let type = 'normal'; // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆè‰²
  if (num.startsWith('A')) type = 'emergency';
  else if (num.includes('R')) type = 'rescue';
  /*else if (num.includes('P')) type = 'pomp';*/
  else if (num.includes('C')) type = 'chemical';
  else if (num.includes('S')) type = 'support';
  else if (/^\d{2}-FD/.test(num)) type = 'firedept';

  // ãƒãƒƒã‚¸HTMLã‚’ä½œæˆ
  vehicles.push(`<span class="vehicle-badge" data-type="${type}">${num}</span>`);
});

// ğŸ”¹ vehicleList ã«çµåˆ
const vehicleList = vehicles.length
  ? vehicles.join(' ')
  : '<p>è»Šä¸¡ç™»éŒ²ãªã—</p>';      
      // --- ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—HTML ---
      const popupHtml = `
        <div style="width:200px">
          <h3 style="margin:0;font-size:16px;">${row.name}</h3>
          <p style="margin:4px 0;">
            <strong></strong> ${row.address}<br>
            <strong>é…ç½®è»Šä¸¡</strong>
          </p>
          <div class="vehicle-badge-box">${vehicleList}</div>
          ${row.photo ? `<img src="photo/${row.photo}" style="width:100%;border-radius:8px;">` : ''}
          ${row.desc ? `<p style="margin-top:6px;">${row.desc}</p>` : ''}
        </div>
      `;
      // â–¼ icon ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’ã“ã“ã§æ¸¡ã™
      L.marker([parseFloat(row.lat), parseFloat(row.lng)], { icon: iconChoice })
        .addTo(map)
        .bindPopup(popupHtml);
    });
  }
});

</script>
</body>
</html>
